-- 📦 Nytherune Hub — Versão Final com UI Compacta e Todas as Funcionalidades Novas

local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local StarterGui = game:GetService("StarterGui")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local TweenService = game:GetService("TweenService")
local Debris = game:GetService("Debris")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

-- 🚨 Configuração de Donos e Moderadores
local DONOS = {
    ["kanakiwhakO"] = true,
    ["JustWX99s"] = true,
}

local MODS = {
    ["alodozhynn"] = true,
}

local TEMP_MODS = {
}

local function IsDono(n) return DONOS[n] == true end
local function IsMod(n) return MODS[n] == true end
local function IsTempMod(n) return TEMP_MODS[n] == true end
local function IsAutorizado(n) return IsDono(n) or IsMod(n) or IsTempMod(n) end

-- 🚨 ATENÇÃO: VERIFIQUE SE O CAMINHO PARA OS REMOTES ESTÁ CORRETO!
local Remotes = ReplicatedStorage:WaitForChild("Remotes")

-- 🧠 Variáveis de Estado
local NYTHERUNE_USERS = {}
local tagsVisiveis = true
local JAILED_PLAYERS = {}
local FROZEN_PLAYERS = {}

-- Configuração de Jumpscares
local JUMPSCARES = {
    { Name = ";jumps1", ImageId = "rbxassetid://126754882337711", AudioId = "rbxassetid://138873214826309" },
    { Name = ";jumps2", ImageId = "rbxassetid://86379969987314", AudioId = "rbxassetid://143942090" },
    { Name = ";jumps3", ImageId = "rbxassetid://127382022168206", AudioId = "rbxassetid://143942090" },
    { Name = ";jumps4", ImageId = "rbxassetid://95973611964555", AudioId = "rbxassetid://138873214826309" },
}

-- Funções de Ação (Freeze, Unfreeze, Jail, Unjail, Float, KillPlus, Jumpscare)
local function FreezePlayer(player)
    if not player or not player.Character then return false end
    local h = player.Character:FindFirstChildOfClass("Humanoid")
    if not h or FROZEN_PLAYERS[player.Name] then return false end
    FROZEN_PLAYERS[player.Name] = { WalkSpeed = h.WalkSpeed, JumpPower = h.JumpPower }
    h.WalkSpeed = 0
    h.JumpPower = 0
    return true
end

local function UnfreezePlayer(player)
    if not player or not FROZEN_PLAYERS[player.Name] then return false end
    local s = FROZEN_PLAYERS[player.Name]
    if player.Character then
        local h = player.Character:FindFirstChildOfClass("Humanoid")
        if h then
            h.WalkSpeed = s.WalkSpeed
            h.JumpPower = s.JumpPower
        end
    end
    FROZEN_PLAYERS[player.Name] = nil
    return true
end

local function CreateAndManageJail(player)
    if not player or not player.Character then return false end
    local e = Workspace:FindFirstChild("Jail_" .. player.Name)
    if e then e:Destroy() end
    if JAILED_PLAYERS[player.Name] and JAILED_PLAYERS[player.Name].loop then task.cancel(JAILED_PLAYERS[player.Name].loop) end

    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return false end

    local m = Instance.new("Model", Workspace)
    m.Name = "Jail_" .. player.Name

    local s = 8
    local p = hrp.Position
    local t = {
        Base = Instance.new("Part", m),
        Roof = Instance.new("Part", m),
        Wall1 = Instance.new("Part", m),
        Wall2 = Instance.new("Part", m),
        Wall3 = Instance.new("Part", m),
        Wall4 = Instance.new("Part", m)
    }

    t.Base.Size = Vector3.new(s, 0.5, s)
    t.Base.Position = p - Vector3.new(0, player.Character.Humanoid.HipHeight + 0.25, 0)
    t.Roof.Size = Vector3.new(s, 0.5, s)
    t.Roof.Position = t.Base.Position + Vector3.new(0, s, 0)
    t.Wall1.Size = Vector3.new(0.5, s, s)
    t.Wall1.Position = t.Base.Position + Vector3.new(s / 2, s / 2, 0)
    t.Wall2.Size = Vector3.new(0.5, s, s)
    t.Wall2.Position = t.Base.Position + Vector3.new(-s / 2, s / 2, 0)
    t.Wall3.Size = Vector3.new(s, s, 0.5)
    t.Wall3.Position = t.Base.Position + Vector3.new(0, s / 2, s / 2)
    t.Wall4.Size = Vector3.new(s, s, 0.5)
    t.Wall4.Position = t.Base.Position + Vector3.new(0, s / 2, -s / 2)

    for _, v in pairs(t) do
        v.Anchored = true
        v.CanCollide = true
        v.Material = Enum.Material.Neon
        v.Color = Color3.fromRGB(0, 200, 255)
        v.Transparency = 0.6
    end

    if player == LocalPlayer then
        local l = task.spawn(function()
            local c = t.Base.Position + Vector3.new(0, player.Character.Humanoid.HipHeight, 0)
            while JAILED_PLAYERS[player.Name] and player.Parent and player.Character and player.Character.Parent do
                local h = player.Character:FindFirstChild("HumanoidRootPart")
                if h and (h.Position - c).Magnitude > (s / 2) - 1 then
                    h.CFrame = CFrame.new(c)
                end
                task.wait(0.1)
            end
        end)
        JAILED_PLAYERS[player.Name] = { loop = l }
    else
        JAILED_PLAYERS[player.Name] = {}
    end
    return true
end

local function RemoveJail(player)
    local w = Workspace:FindFirstChild("Jail_" .. player.Name)
    if w then w:Destroy() end
    if not player or not JAILED_PLAYERS[player.Name] then return false end
    local d = JAILED_PLAYERS[player.Name]
    if d.loop then task.cancel(d.loop) end
    JAILED_PLAYERS[player.Name] = nil
    return true
end

local function FloatPlayer(player)
    if not player or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") or not player.Character:FindFirstChildOfClass("Humanoid") then return false end
    local targetHrp = player.Character.HumanoidRootPart
    local targetHumanoid = player.Character:FindFirstChildOfClass("Humanoid")
    local targetPos = targetHrp.Position
    targetHumanoid.WalkSpeed = 0
    targetHumanoid.JumpHeight = 0

    local bodyVelocity = Instance.new("BodyVelocity", targetHrp)
    bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
    bodyVelocity.Velocity = Vector3.new(0, 10, 0)
    bodyVelocity.Name = "FloatVelocity"

    local maxHeight = targetPos.Y + 50
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not player.Character or not player.Character.Parent or not targetHrp.Parent or not targetHumanoid.Parent then
            if bodyVelocity and bodyVelocity.Parent then bodyVelocity:Destroy() end
            if connection then connection:Disconnect() end
            return
        end
        if targetHrp.Position.Y >= maxHeight then
            if bodyVelocity and bodyVelocity.Parent then bodyVelocity:Destroy() end
            if connection then connection:Disconnect() end
            targetHumanoid.Health = 0
        end
    end)
    return true
end

local function KillPlus(player)
    if not player or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return false end
    local targetHrp = player.Character.HumanoidRootPart
    local targetPos = targetHrp.Position
    local parts = {}
    local numParts = 5

    local folder = Instance.new("Folder", Workspace)
    folder.Name = "KillPlusTemp_" .. player.Name

    for i = 1, numParts do
        local part = Instance.new("Part")
        part.Name = "KillPlusPart_" .. player.Name .. "_" .. i
        part.Size = Vector3.new(2, 2, 2)
        part.Position = targetPos + Vector3.new(math.random(-10, 10), -5, math.random(-10, 10))
        part.Anchored = true
        part.CanCollide = true
        part.Material = Enum.Material.Neon
        part.Color = Color3.fromRGB(255, 0, 0)
        part.Parent = folder
        table.insert(parts, part)
    end

    local speed = 50
    for _, part in ipairs(parts) do
        local distance = (targetPos - part.Position).Magnitude
        local duration = math.max(0.1, distance / speed)
        local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Linear)
        local tween = TweenService:Create(part, tweenInfo, { Position = targetPos + Vector3.new(0, 1, 0) })
        part.Anchored = false
        tween:Play()

        part.Touched:Connect(function(hit)
            if hit.Parent == player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local bodyVelocity = Instance.new("BodyVelocity", targetHrp)
                bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
                bodyVelocity.Velocity = Vector3.new(math.random(-50, 50), 100, math.random(-50, 50))
                Debris:AddItem(bodyVelocity, 0.5)
            end
        end)
    end

    Debris:AddItem(folder, 5)
    return true
end

local function TriggerJumpscare(player, jumpscare)
    -- Jumpscare local (apenas executa para LocalPlayer)
    if not player or player ~= LocalPlayer then return false end
    local screenGui = Instance.new("ScreenGui", CoreGui)
    screenGui.Name = "JumpscareGui"
    screenGui.IgnoreGuiInset = true
    screenGui.ResetOnSpawn = false

    local imageLabel = Instance.new("ImageLabel", screenGui)
    imageLabel.Size = UDim2.new(1, 0, 1, 0)
    imageLabel.Position = UDim2.new(0, 0, 0, 0)
    imageLabel.BackgroundTransparency = 1
    imageLabel.Image = jumpscare.ImageId

    local sound = Instance.new("Sound", screenGui)
    sound.SoundId = jumpscare.AudioId
    sound.Volume = 1
    sound.Looped = false
    sound:Play()

    local flashCount = 10
    local flashInterval = 0.2
    for i = 1, flashCount do
        if not screenGui.Parent then break end
        imageLabel.ImageTransparency = (i % 2 == 0) and 0.3 or 0
        task.wait(flashInterval)
    end

    sound:Stop()
    screenGui:Destroy()
    return true
end

Players.PlayerRemoving:Connect(function(player)
    RemoveJail(player)
    UnfreezePlayer(player)
    NYTHERUNE_USERS[player.Name] = nil
    TEMP_MODS[player.Name] = nil
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local bodyVelocity = player.Character.HumanoidRootPart:FindFirstChild("FloatVelocity")
        if bodyVelocity then bodyVelocity:Destroy() end
    end
    for i = 1, 5 do
        local part = Workspace:FindFirstChild("KillPlusPart_" .. player.Name .. "_" .. i)
        if part then part:Destroy() end
    end
end)

-- Configuração da UI Compacta
local function CreateAdminUI()
    if CoreGui:FindFirstChild("NythAdminUI") then return end
    local screen = Instance.new("ScreenGui", CoreGui)
    screen.Name = "NythAdminUI"
    screen.ResetOnSpawn = false

    local panel = Instance.new("Frame", screen)
    panel.Size = UDim2.new(0, 320, 0, 450)
    panel.Position = UDim2.new(0.5, -160, 0.5, -225)
    panel.BackgroundColor3 = Color3.fromRGB(48, 0, 48)
    panel.Active = true
    panel.Draggable = true
    Instance.new("UICorner", panel).CornerRadius = UDim.new(0, 8)
    local fullSz = panel.Size

    local header = Instance.new("Frame", panel)
    header.Size = UDim2.new(1, 0, 0, 36)
    header.BackgroundTransparency = 1

    local title = Instance.new("TextLabel", header)
    title.Text = "Nytherune Hub"
    title.Size = UDim2.new(1, -70, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextXAlignment = Enum.TextXAlignment.Left

    local btnClose = Instance.new("TextButton", header)
    btnClose.Text = "✖"
    btnClose.Font = Enum.Font.GothamBold
    btnClose.TextSize = 14
    btnClose.TextColor3 = Color3.new(1, 1, 1)
    btnClose.BackgroundTransparency = 1
    btnClose.Size = UDim2.new(0, 25, 0, 25)
    btnClose.Position = UDim2.new(1, -30, 0, 5)
    btnClose.MouseButton1Click:Connect(function() screen:Destroy() end)

    local btnMin = Instance.new("TextButton", header)
    btnMin.Text = "="
    btnMin.Font = Enum.Font.GothamBold
    btnMin.TextSize = 14
    btnMin.TextColor3 = Color3.new(1, 1, 1)
    btnMin.BackgroundTransparency = 1
    btnMin.Size = UDim2.new(0, 25, 0, 25)
    btnMin.Position = UDim2.new(1, -60, 0, 5)

    local tabContainer = Instance.new("Frame", panel)
    tabContainer.Size = UDim2.new(1, 0, 0, 30)
    tabContainer.Position = UDim2.new(0, 0, 0, 36)
    tabContainer.BackgroundTransparency = 1
    local tabLayout = Instance.new("UIListLayout", tabContainer)
    tabLayout.FillDirection = Enum.FillDirection.Horizontal
    tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabLayout.Padding = UDim.new(0, 5)

    local body = Instance.new("Frame", panel)
    body.Size = UDim2.new(1, 0, 1, -70)
    body.Position = UDim2.new(0, 0, 0, 70)
    body.BackgroundTransparency = 1

    local minimized = false
    btnMin.MouseButton1Click:Connect(function()
        minimized = not minimized
        body.Visible = not minimized
        tabContainer.Visible = not minimized
        if minimized then
            panel.Size = UDim2.new(0, 180, 0, 36)
            btnMin.Text = "+"
        else
            panel.Size = fullSz
            btnMin.Text = ""
        end
    end)

    local cmdFrame = Instance.new("ScrollingFrame", body)
    cmdFrame.Size = UDim2.new(1, 0, 1, 0)
    cmdFrame.BackgroundTransparency = 1
    cmdFrame.BorderSizePixel = 0
    cmdFrame.ScrollBarImageColor3 = Color3.fromRGB(150, 105, 180)
    cmdFrame.ScrollBarThickness = 6
    local cmdListLayout = Instance.new("UIListLayout", cmdFrame)
    cmdListLayout.Padding = UDim.new(0, 8)
    cmdListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    cmdListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    local avatarFrame = Instance.new("ScrollingFrame", body)
    avatarFrame.Size = UDim2.new(1, 0, 1, 0)
    avatarFrame.BackgroundTransparency = 1
    avatarFrame.BorderSizePixel = 0
    avatarFrame.ScrollBarImageColor3 = Color3.fromRGB(150, 105, 180)
    avatarFrame.ScrollBarThickness = 6
    avatarFrame.Visible = false
    local avatarListLayout = Instance.new("UIListLayout", avatarFrame)
    avatarListLayout.Padding = UDim.new(0, 8)
    avatarListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    avatarListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    local terrorFrame = Instance.new("ScrollingFrame", body)
    terrorFrame.Size = UDim2.new(1, 0, 1, 0)
    terrorFrame.BackgroundTransparency = 1
    terrorFrame.BorderSizePixel = 0
    terrorFrame.ScrollBarImageColor3 = Color3.fromRGB(150, 105, 180)
    terrorFrame.ScrollBarThickness = 6
    terrorFrame.Visible = false
    local terrorListLayout = Instance.new("UIListLayout", terrorFrame)
    terrorListLayout.Padding = UDim.new(0, 8)
    terrorListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    terrorListLayout.SortOrder = Enum.SortOrder.LayoutOrder

    local btnTabCmds = Instance.new("TextButton", tabContainer)
    btnTabCmds.Name = "CmdsTab"
    btnTabCmds.Text = "Comandos"
    btnTabCmds.Font = Enum.Font.GothamBold
    btnTabCmds.TextSize = 14
    btnTabCmds.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btnTabCmds.TextColor3 = Color3.new(1, 1, 1)
    btnTabCmds.Size = UDim2.new(0.33, -5, 1, 0)

    local btnTabAvatar = Instance.new("TextButton", tabContainer)
    btnTabAvatar.Name = "AvatarTab"
    btnTabAvatar.Text = "Avatar"
    btnTabAvatar.Font = Enum.Font.Gotham
    btnTabAvatar.TextSize = 14
    btnTabAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btnTabAvatar.TextColor3 = Color3.new(0.8, 0.8, 0.8)
    btnTabAvatar.Size = UDim2.new(0.33, -5, 1, 0)

    local btnTabTerror = Instance.new("TextButton", tabContainer)
    btnTabTerror.Name = "TerrorTab"
    btnTabTerror.Text = "Terror"
    btnTabTerror.Font = Enum.Font.Gotham
    btnTabTerror.TextSize = 14
    btnTabTerror.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btnTabTerror.TextColor3 = Color3.new(0.8, 0.8, 0.8)
    btnTabTerror.Size = UDim2.new(0.33, -5, 1, 0)

    local function switchTab(tab)
        if tab == "cmds" then
            cmdFrame.Visible = true
            avatarFrame.Visible = false
            terrorFrame.Visible = false
            btnTabCmds.Font = Enum.Font.GothamBold
            btnTabCmds.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            btnTabAvatar.Font = Enum.Font.Gotham
            btnTabAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            btnTabTerror.Font = Enum.Font.Gotham
            btnTabTerror.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        elseif tab == "avatar" then
            avatarFrame.Visible = true
            cmdFrame.Visible = false
            terrorFrame.Visible = false
            btnTabAvatar.Font = Enum.Font.GothamBold
            btnTabAvatar.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            btnTabCmds.Font = Enum.Font.Gotham
            btnTabCmds.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            btnTabTerror.Font = Enum.Font.Gotham
            btnTabTerror.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        else
            terrorFrame.Visible = true
            cmdFrame.Visible = false
            avatarFrame.Visible = false
            btnTabTerror.Font = Enum.Font.GothamBold
            btnTabTerror.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            btnTabCmds.Font = Enum.Font.Gotham
            btnTabCmds.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
            btnTabAvatar.Font = Enum.Font.Gotham
            btnTabAvatar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        end
    end

    btnTabCmds.MouseButton1Click:Connect(function() switchTab("cmds") end)
    btnTabAvatar.MouseButton1Click:Connect(function() switchTab("avatar") end)
    btnTabTerror.MouseButton1Click:Connect(function() switchTab("terror") end)

    -- Comandos (lista e dropdown de alvo)
    local selectedCmdTarget = nil
    local ddCmd = Instance.new("TextButton", cmdFrame)
    ddCmd.Name = "Dropdown"
    ddCmd.Text = "🎯 Selecionar jogador"
    ddCmd.Font = Enum.Font.Gotham
    ddCmd.TextSize = 14
    ddCmd.TextColor3 = Color3.new(1, 1, 1)
    ddCmd.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    ddCmd.Size = UDim2.new(1, -20, 0, 30)
    ddCmd.LayoutOrder = 1

    local openCmd = false
    local frameDDCmd = nil
    ddCmd.MouseButton1Click:Connect(function()
        if openCmd and frameDDCmd then frameDDCmd:Destroy() openCmd = false return end
        frameDDCmd = Instance.new("ScrollingFrame", cmdFrame)
        frameDDCmd.Position = UDim2.new(0.5, -((cmdFrame.AbsoluteSize.X - 20) / 2), 0, 40)
        frameDDCmd.Size = UDim2.new(1, -20, 0, 120)
        frameDDCmd.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frameDDCmd.BorderSizePixel = 0
        frameDDCmd.ClipsDescendants = true
        frameDDCmd.LayoutOrder = 2
        local lst = Instance.new("UIListLayout", frameDDCmd)
        lst.Padding = UDim.new(0, 2)

        local playersInServer = {}
        for _, p in ipairs(Players:GetPlayers()) do table.insert(playersInServer, p.Name) end
        table.sort(playersInServer)
        for _, name in ipairs(playersInServer) do
            local b = Instance.new("TextButton", frameDDCmd)
            b.Text = name
            b.Font = Enum.Font.Gotham
            b.TextSize = 14
            b.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            b.TextColor3 = Color3.new(1, 1, 1)
            b.Size = UDim2.new(1, 0, 0, 25)
            b.MouseButton1Click:Connect(function()
                selectedCmdTarget = name
                ddCmd.Text = "🎯 " .. name
                frameDDCmd:Destroy()
                openCmd = false
            end)
        end
        openCmd = true
    end)

    local cmdContainer = Instance.new("Frame", cmdFrame)
    cmdContainer.BackgroundTransparency = 1
    cmdContainer.Size = UDim2.new(1, -20, 0, 0)
    cmdContainer.AutomaticSize = Enum.AutomaticSize.Y
    cmdContainer.LayoutOrder = 3
    local uiListLayout = Instance.new("UIListLayout", cmdContainer)
    uiListLayout.Padding = UDim.new(0, 6)

    local cmds = { ";verifique", ";kick", ";crash", ";kill", ";killplus", ";bring", ";jail", ";unjail", ";freeze", ";unfreeze", ";adm", ";unadm", ";tag", ";untag", ";tag all", ";untag all", ";float" }
    local needsTarget = { ";kick", ";crash", ";kill", ";killplus", ";bring", ";jail", ";unjail", ";freeze", ";unfreeze", ";adm", ";unadm", ";float" }

    for _, lbl in ipairs(cmds) do
        local b = Instance.new("TextButton", cmdContainer)
        b.Size = UDim2.new(1, 0, 0, 36)
        b.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        b.TextColor3 = Color3.new(1, 1, 1)
        b.Font = Enum.Font.GothamBold
        b.TextSize = 16
        b.Text = lbl
        b.MouseButton1Click:Connect(function()
            local cmdText = lbl
            local requiresTarget = table.find(needsTarget, lbl)
            if requiresTarget and not selectedCmdTarget then
                StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] ❌ Selecione um jogador na aba de Comandos!", Color = Color3.fromRGB(255, 100, 100), Font = Enum.Font.GothamBold })
                return
            end
            if requiresTarget then cmdText = lbl .. " " .. selectedCmdTarget end
            pcall(function()
                local channel = nil
                if TextChatService:FindFirstChild("TextChannels") then
                    channel = TextChatService:WaitForChild("TextChannels"):FindFirstChild("RBXGeneral") or TextChatService:WaitForChild("TextChannels"):GetChildren()[1]
                end
                if channel then
                    channel:SendAsync(cmdText)
                    if cmdText == ";verifique" then
                        StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] Comando ;verifique enviado com sucesso!", Color = Color3.fromRGB(0, 255, 0), Font = Enum.Font.GothamBold })
                    end
                else
                    StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] Erro: Canal de chat não encontrado!", Color = Color3.fromRGB(255, 100, 100), Font = Enum.Font.GothamBold })
                end
            end)
        end)
    end

    -- Enviar chat como outro jogador
    local chatAsLabel = Instance.new("TextLabel", cmdContainer)
    chatAsLabel.Size = UDim2.new(1, 0, 0, 20)
    chatAsLabel.BackgroundTransparency = 1
    chatAsLabel.TextColor3 = Color3.new(1, 1, 1)
    chatAsLabel.Font = Enum.Font.GothamBold
    chatAsLabel.Text = "Enviar mensagem como alvo:"
    chatAsLabel.TextXAlignment = Enum.TextXAlignment.Left
    chatAsLabel.TextSize = 14

    local txtChatAs = Instance.new("TextBox", cmdContainer)
    txtChatAs.Size = UDim2.new(1, 0, 0, 36)
    txtChatAs.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    txtChatAs.TextColor3 = Color3.new(1, 1, 1)
    txtChatAs.Font = Enum.Font.Gotham
    txtChatAs.TextSize = 14
    txtChatAs.PlaceholderText = "Digite a mensagem aqui..."

    local btnChatAs = Instance.new("TextButton", cmdContainer)
    btnChatAs.Size = UDim2.new(1, 0, 0, 36)
    btnChatAs.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btnChatAs.TextColor3 = Color3.new(1, 1, 1)
    btnChatAs.Font = Enum.Font.GothamBold
    btnChatAs.TextSize = 16
    btnChatAs.Text = ";ch (Enviar)"
    btnChatAs.MouseButton1Click:Connect(function()
        local msgToSend = txtChatAs.Text
        if not selectedCmdTarget then
            StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] ❌ Selecione um jogador alvo primeiro!", Color = Color3.fromRGB(255, 100, 100), Font = Enum.Font.GothamBold })
            return
        end
        if msgToSend == "" then
            StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] ❌ Digite uma mensagem para enviar!", Color = Color3.fromRGB(255, 100, 100), Font = Enum.Font.GothamBold })
            return
        end
        local cmdText = ";ch " .. selectedCmdTarget .. " " .. msgToSend
        pcall(function()
            local channel = nil
            if TextChatService:FindFirstChild("TextChannels") then
                channel = TextChatService:WaitForChild("TextChannels"):FindFirstChild("RBXGeneral") or TextChatService:WaitForChild("TextChannels"):GetChildren()[1]
            end
            if channel then
                channel:SendAsync(cmdText)
                StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] Mensagem enviada como " .. selectedCmdTarget, Color = Color3.fromRGB(0, 255, 0), Font = Enum.Font.GothamBold })
                txtChatAs.Text = ""
            else
                StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] Erro: Canal de chat não encontrado!", Color = Color3.fromRGB(255, 100, 100), Font = Enum.Font.GothamBold })
            end
        end)
    end)

    -- Aba Avatar (copiar avatar)
    local selectedCopier, selectedAvatarTarget = nil, nil

    local labelCopier = Instance.new("TextLabel", avatarFrame)
    labelCopier.Text = "👤 Quem vai copiar (Copiador):"
    labelCopier.Font = Enum.Font.GothamBold
    labelCopier.TextColor3 = Color3.new(1, 1, 1)
    labelCopier.BackgroundTransparency = 1
    labelCopier.Size = UDim2.new(1, -20, 0, 20)
    labelCopier.TextXAlignment = Enum.TextXAlignment.Left
    labelCopier.LayoutOrder = 1

    local ddCopier = Instance.new("TextButton", avatarFrame)
    ddCopier.Name = "DropdownCopier"
    ddCopier.Text = "👇 Selecione o copiador"
    ddCopier.Font = Enum.Font.Gotham
    ddCopier.TextSize = 14
    ddCopier.TextColor3 = Color3.new(1, 1, 1)
    ddCopier.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    ddCopier.Size = UDim2.new(1, -20, 0, 30)
    ddCopier.LayoutOrder = 2

    local openCopier, frameDDCopier = false, nil
    ddCopier.MouseButton1Click:Connect(function()
        if openCopier and frameDDCopier then frameDDCopier:Destroy() openCopier = false return end
        frameDDCopier = Instance.new("ScrollingFrame", avatarFrame)
        frameDDCopier.Position = UDim2.new(0.5, -((avatarFrame.AbsoluteSize.X - 20) / 2), 0, 90)
        frameDDCopier.Size = UDim2.new(1, -20, 0, 120)
        frameDDCopier.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frameDDCopier.BorderSizePixel = 0
        frameDDCopier.ClipsDescendants = true
        frameDDCopier.LayoutOrder = 3
        local lst = Instance.new("UIListLayout", frameDDCopier)
        lst.Padding = UDim.new(0, 2)

        local playersInServer = {}
        for _, p in ipairs(Players:GetPlayers()) do table.insert(playersInServer, p.Name) end
        table.sort(playersInServer)
        for _, name in ipairs(playersInServer) do
            local b = Instance.new("TextButton", frameDDCopier)
            b.Text = name
            b.Font = Enum.Font.Gotham
            b.TextSize = 14
            b.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            b.TextColor3 = Color3.new(1, 1, 1)
            b.Size = UDim2.new(1, 0, 0, 25)
            b.MouseButton1Click:Connect(function()
                selectedCopier = name
                ddCopier.Text = "👤 " .. name
                frameDDCopier:Destroy()
                openCopier = false
            end)
        end
        openCopier = true
    end)

    local labelTarget = Instance.new("TextLabel", avatarFrame)
    labelTarget.Text = "🎯 Copiar avatar de (Alvo):"
    labelTarget.Font = Enum.Font.GothamBold
    labelTarget.TextColor3 = Color3.new(1, 1, 1)
    labelTarget.BackgroundTransparency = 1
    labelTarget.Size = UDim2.new(1, -20, 0, 20)
    labelTarget.TextXAlignment = Enum.TextXAlignment.Left
    labelTarget.LayoutOrder = 4

    local ddAvatarTarget = Instance.new("TextButton", avatarFrame)
    ddAvatarTarget.Name = "DropdownTarget"
    ddAvatarTarget.Text = "👇 Selecione o alvo"
    ddAvatarTarget.Font = Enum.Font.Gotham
    ddAvatarTarget.TextSize = 14
    ddAvatarTarget.TextColor3 = Color3.new(1, 1, 1)
    ddAvatarTarget.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    ddAvatarTarget.Size = UDim2.new(1, -20, 0, 30)
    ddAvatarTarget.LayoutOrder = 5

    local openAvatarTarget, frameDDAvatarTarget = false, nil
    ddAvatarTarget.MouseButton1Click:Connect(function()
        if openAvatarTarget and frameDDAvatarTarget then frameDDAvatarTarget:Destroy() openAvatarTarget = false return end
        frameDDAvatarTarget = Instance.new("ScrollingFrame", avatarFrame)
        frameDDAvatarTarget.Position = UDim2.new(0.5, -((avatarFrame.AbsoluteSize.X - 20) / 2), 0, 180)
        frameDDAvatarTarget.Size = UDim2.new(1, -20, 0, 120)
        frameDDAvatarTarget.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frameDDAvatarTarget.BorderSizePixel = 0
        frameDDAvatarTarget.ClipsDescendants = true
        frameDDAvatarTarget.LayoutOrder = 6
        local lst = Instance.new("UIListLayout", frameDDAvatarTarget)
        lst.Padding = UDim.new(0, 2)

        local playersInServer = {}
        for _, p in ipairs(Players:GetPlayers()) do table.insert(playersInServer, p.Name) end
        table.sort(playersInServer)
        for _, name in ipairs(playersInServer) do
            local b = Instance.new("TextButton", frameDDAvatarTarget)
            b.Text = name
            b.Font = Enum.Font.Gotham
            b.TextSize = 14
            b.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            b.TextColor3 = Color3.new(1, 1, 1)
            b.Size = UDim2.new(1, 0, 0, 25)
            b.MouseButton1Click:Connect(function()
                selectedAvatarTarget = name
                ddAvatarTarget.Text = "🎯 " .. name
                frameDDAvatarTarget:Destroy()
                openAvatarTarget = false
            end)
        end
        openAvatarTarget = true
    end)

    local btnCopyAvatar = Instance.new("TextButton", avatarFrame)
    btnCopyAvatar.Size = UDim2.new(1, -20, 0, 36)
    btnCopyAvatar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btnCopyAvatar.TextColor3 = Color3.new(1, 1, 1)
    btnCopyAvatar.Font = Enum.Font.GothamBold
    btnCopyAvatar.TextSize = 16
    btnCopyAvatar.Text = "Copiar Avatar"
    btnCopyAvatar.LayoutOrder = 7
    btnCopyAvatar.MouseButton1Click:Connect(function()
        if not selectedCopier or not selectedAvatarTarget then
            StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] ❌ Selecione o Copiador e o Alvo na aba Avatar!", Color = Color3.fromRGB(255, 100, 100), Font = Enum.Font.GothamBold })
            return
        end
        local cmdText = ";copy " .. selectedAvatarTarget .. " " .. selectedCopier
        pcall(function()
            local channel = nil
            if TextChatService:FindFirstChild("TextChannels") then
                channel = TextChatService:WaitForChild("TextChannels"):FindFirstChild("RBXGeneral") or TextChatService:WaitForChild("TextChannels"):GetChildren()[1]
            end
            if channel then channel:SendAsync(cmdText) end
        end)
    end)

    -- Aba Terror (jumpscares)
    local selectedJumpscareTarget = nil
    local ddJumpscare = Instance.new("TextButton", terrorFrame)
    ddJumpscare.Name = "DropdownJumpscare"
    ddJumpscare.Text = "🎯 Selecionar jogador"
    ddJumpscare.Font = Enum.Font.Gotham
    ddJumpscare.TextSize = 14
    ddJumpscare.TextColor3 = Color3.new(1, 1, 1)
    ddJumpscare.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    ddJumpscare.Size = UDim2.new(1, -20, 0, 30)
    ddJumpscare.LayoutOrder = 1

    local openJumpscare = false
    local frameDDJumpscare = nil
    ddJumpscare.MouseButton1Click:Connect(function()
        if openJumpscare and frameDDJumpscare then frameDDJumpscare:Destroy() openJumpscare = false return end
        frameDDJumpscare = Instance.new("ScrollingFrame", terrorFrame)
        frameDDJumpscare.Position = UDim2.new(0.5, -((terrorFrame.AbsoluteSize.X - 20) / 2), 0, 40)
        frameDDJumpscare.Size = UDim2.new(1, -20, 0, 120)
        frameDDJumpscare.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        frameDDJumpscare.BorderSizePixel = 0
        frameDDJumpscare.ClipsDescendants = true
        frameDDJumpscare.LayoutOrder = 2
        local lst = Instance.new("UIListLayout", frameDDJumpscare)
        lst.Padding = UDim.new(0, 2)

        local playersInServer = {}
        for _, p in ipairs(Players:GetPlayers()) do table.insert(playersInServer, p.Name) end
        table.sort(playersInServer)
        for _, name in ipairs(playersInServer) do
            local b = Instance.new("TextButton", frameDDJumpscare)
            b.Text = name
            b.Font = Enum.Font.Gotham
            b.TextSize = 14
            b.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            b.TextColor3 = Color3.new(1, 1, 1)
            b.Size = UDim2.new(1, 0, 0, 25)
            b.MouseButton1Click:Connect(function()
                selectedJumpscareTarget = name
                ddJumpscare.Text = "🎯 " .. name
                frameDDJumpscare:Destroy()
                openJumpscare = false
            end)
        end
        openJumpscare = true
    end)

    for _, jumpscare in ipairs(JUMPSCARES) do
        local b = Instance.new("TextButton", terrorFrame)
        b.Size = UDim2.new(1, -20, 0, 36)
        b.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        b.TextColor3 = Color3.new(1, 1, 1)
        b.Font = Enum.Font.GothamBold
        b.TextSize = 16
        b.Text = jumpscare.Name
        b.LayoutOrder = 3
        b.MouseButton1Click:Connect(function()
            if not selectedJumpscareTarget then
                StarterGui:SetCore("ChatMakeSystemMessage", { Text = "[Nytherune Hub] ❌ Selecione um jogador na aba Terror!", Color = Color3.fromRGB(255, 100, 100), Font = Enum.Font.GothamBold })
                return
            end
            local cmdText = jumpscare.Name .. " " .. selectedJumpscareTarget
            pcall(function()
                local channel = nil
                if TextChatService:FindFirstChild("TextChannels") then
                    channel = TextChatService:WaitForChild("TextChannels"):FindFirstChild("RBXGeneral") or TextChatService:WaitForChild("TextChannels"):GetChildren()[1]
                end
                if channel then channel:SendAsync(cmdText) end
            end)
        end)
    end
end

local function DestroyAdminUI()
    local ui = CoreGui:FindFirstChild("NythAdminUI")
    if ui and ui.Parent then ui:Destroy() end
end

-- Botão Móvel
local function CreateMovableButton()
    if CoreGui:FindFirstChild("NythMovableButtonGui") then return end
    local screenGui = Instance.new("ScreenGui", CoreGui)
    screenGui.Name = "NythMovableButtonGui"
    screenGui.ResetOnSpawn = false
    local button = Instance.new("ImageButton", screenGui)
    button.Size = UDim2.new(0, 50, 0, 50)
    button.Position = UDim2.new(0, 100, 0, 100)
    button.BackgroundTransparency = 1
    button.Image = "rbxassetid://137769737773573"
    button.Active = true
    button.Draggable = true
    button.MouseButton1Click:Connect(function()
        local ui = CoreGui:FindFirstChild("NythAdminUI")
        if ui then ui:Destroy() else CreateAdminUI() end
    end)
end


